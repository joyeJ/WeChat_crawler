
                        

                        

                        
                        
                        <blockquote style="font-size: 16px; white-space: normal; max-width: 100%; color: rgb(62, 62, 62); line-height: 25.6px; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><p style="max-width: 100%; min-height: 1em; line-height: 25.6px; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; color: rgb(0, 82, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><strong style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 14px; box-sizing: border-box !important; word-wrap: break-word !important;">来自：码农翻身（微信号：coderising）</span></strong></span></p><p style="max-width: 100%; min-height: 1em; line-height: 25.6px; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; color: rgb(0, 82, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><strong style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 14px; box-sizing: border-box !important; word-wrap: break-word !important;">作者：刘欣</span></strong></span></p></blockquote><p style="font-size: 16px; white-space: normal; max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); line-height: 25.6px; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><br/></p><p><br/></p><section class="" powered-by="xiumi.us" style="font-size: 16px; white-space: normal; max-width: 100%; box-sizing: border-box; color: rgb(62, 62, 62); line-height: 25.6px; background-color: rgb(255, 255, 255); word-wrap: break-word !important;"><section class="" style="margin-top: 10px; margin-bottom: 10px; max-width: 100%; box-sizing: border-box; word-wrap: break-word !important;"><section class="" style="padding: 10px; max-width: 100%; box-sizing: border-box; display: inline-block; width: 670px; border-width: 1px; border-style: solid; border-color: rgb(192, 200, 209); background-color: rgb(239, 239, 239); word-wrap: break-word !important;"><section class="" powered-by="xiumi.us" style="max-width: 100%; box-sizing: border-box; word-wrap: break-word !important;"><section class="" style="max-width: 100%; box-sizing: border-box; word-wrap: break-word !important;"><section class="" style="max-width: 100%; box-sizing: border-box; word-wrap: break-word !important;"><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; word-wrap: break-word !important;">连接， 连接， 总是连接！</p><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; word-wrap: break-word !important;">生活中肯定有比数据库连接更有趣的事情。</p></section></section></section></section></section></section><section class="" powered-by="xiumi.us" style="font-size: 16px; white-space: normal; max-width: 100%; box-sizing: border-box; color: rgb(62, 62, 62); line-height: 25.6px; background-color: rgb(255, 255, 255); word-wrap: break-word !important;"><section class="" style="margin-top: 10px; margin-bottom: 10px; max-width: 100%; box-sizing: border-box; word-wrap: break-word !important;"><section class="" style="padding: 2px; max-width: 100%; box-sizing: border-box; display: inline-block; background-color: rgb(0, 0, 0); word-wrap: break-word !important;"><section class="" style="margin-right: 5px; padding-right: 8px; padding-left: 8px; max-width: 100%; box-sizing: border-box; display: inline-block; color: rgb(255, 255, 255); background-color: rgb(95, 156, 239); word-wrap: break-word !important;"><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; word-wrap: break-word !important;">1</p></section><section class="" style="padding-right: 5px; padding-left: 5px; max-width: 100%; box-sizing: border-box; display: inline-block; color: rgb(255, 255, 255); word-wrap: break-word !important;"><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; word-wrap: break-word !important;">数据库连接</p></section></section></section></section><section class="" powered-by="xiumi.us" style="font-size: 16px; white-space: normal; max-width: 100%; box-sizing: border-box; color: rgb(62, 62, 62); line-height: 25.6px; background-color: rgb(255, 255, 255); word-wrap: break-word !important;"><section class="" style="max-width: 100%; box-sizing: border-box; word-wrap: break-word !important;"><section class="" style="max-width: 100%; box-sizing: border-box; word-wrap: break-word !important;"><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; word-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"/></p><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; word-wrap: break-word !important;">又到了数据库连接的时间！</p><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; word-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box; word-wrap: break-word !important;"/></p><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; word-wrap: break-word !important;">那些码农把数据库参数送过来，  Oracle , Db2,  Sybase, SQL Server这些JDBC Driver 懒洋洋起来去干活赚钱。</p><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; word-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box; word-wrap: break-word !important;"/></p><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; word-wrap: break-word !important;">小东也是其中之一,  每天的工作就是连接Mysql 数据库， 发出SQL查询， 获取结果集。</p><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; word-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box; word-wrap: break-word !important;"/></p><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; word-wrap: break-word !important;">工作稳定， 收入不菲， 只是日复一日，年复一年， 枯燥的工作实在是太令人厌烦了。</p><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; word-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box; word-wrap: break-word !important;"/></p><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; word-wrap: break-word !important;">有时候小东会和其他JDBC Driver 聊天， 谈起有些不着调的码农， 创建一个Connection,  发出一个查询， 处理完ResultSet后 ， 立刻就把Connection给关掉了。</p><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; word-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box; word-wrap: break-word !important;"/></p><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; word-wrap: break-word !important;">“他们简直不知道我们建立一个数据连接有多么辛苦， 先通过Socket 建立TCP连接， 然后还要有应用层的握手协议， 唉， 不知道要干多少脏活累活， 这帮码农用完就关， 真是浪费啊。 ”</p><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; word-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box; word-wrap: break-word !important;"/></p><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; word-wrap: break-word !important;">“还有更可气的， 有些家伙使用了PreparedStatement , 我通知数据库做了预编译， 制定了查询计划， 为此我还花费了不菲的小费。   但是只执行了一次查询， Connection就关掉了， PreparedStatement 也就不可用了， 现在数据库都懒的给我做预编译了 ！”</p><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; word-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box; word-wrap: break-word !important;"/></p><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; word-wrap: break-word !important;">“你们这都是好的， 有些极品根本就不关闭Connection,  最后让这个Connection 进入了不可控状态。 ”</p><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; word-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box; word-wrap: break-word !important;"/></p><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; word-wrap: break-word !important;">“我们啊， 都把宝贵的生命都献给了数据库连接事业...... ”</p><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; word-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box; word-wrap: break-word !important;"/></p><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; word-wrap: break-word !important;">抱怨归抱怨， 大部分人都安于现状，逆来顺受了。</p></section></section></section><section class="" powered-by="xiumi.us" style="font-size: 16px; white-space: normal; max-width: 100%; box-sizing: border-box; color: rgb(62, 62, 62); line-height: 25.6px; background-color: rgb(255, 255, 255); word-wrap: break-word !important;"><section class="" style="margin-top: 10px; margin-bottom: 10px; max-width: 100%; box-sizing: border-box; word-wrap: break-word !important;"><section class="" style="padding: 2px; max-width: 100%; box-sizing: border-box; display: inline-block; background-color: rgb(0, 0, 0); word-wrap: break-word !important;"><section class="" style="margin-right: 5px; padding-right: 8px; padding-left: 8px; max-width: 100%; box-sizing: border-box; display: inline-block; color: rgb(255, 255, 255); background-color: rgb(95, 156, 239); word-wrap: break-word !important;"><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; word-wrap: break-word !important;">2</p></section><section class="" style="padding-right: 5px; padding-left: 5px; max-width: 100%; box-sizing: border-box; display: inline-block; color: rgb(255, 255, 255); word-wrap: break-word !important;"><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; word-wrap: break-word !important;">向Tomcat取经</p></section></section></section></section><section class="" powered-by="xiumi.us" style="font-size: 16px; white-space: normal; max-width: 100%; box-sizing: border-box; color: rgb(62, 62, 62); line-height: 25.6px; background-color: rgb(255, 255, 255); word-wrap: break-word !important;"><section class="" style="max-width: 100%; box-sizing: border-box; word-wrap: break-word !important;"><section class="" style="max-width: 100%; box-sizing: border-box; word-wrap: break-word !important;"><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; word-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"/></p><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; word-wrap: break-word !important;">但是不安分的小东决心改变， 他四处拜访取经，  但是一无所获。</p><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; word-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box; word-wrap: break-word !important;"/></p><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; word-wrap: break-word !important;">这一天在Tomcat村遇到了Tomcat 村长，  看到了村长处理Http请求的方式， 突然间看到了曙光。</p><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; word-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box; word-wrap: break-word !important;"/></p><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; word-wrap: break-word !important;">村长说： 我们本来是一个线程处理一个Http请求  ，  一个Http请求来到我们这里以后，  我并不会新建一个线程来处理，  而是从一个小黑屋叫来一个线程直接干活， 干完活以后再回到小黑屋待着。</p><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; word-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box; word-wrap: break-word !important;"/></p><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; word-wrap: break-word !important;">小东问： 小黑屋是什么？</p><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; word-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box; word-wrap: break-word !important;"/></p><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; word-wrap: break-word !important;">（注： 参见文章《我是一个线程》，返回上一级回复数字：<span style="color: rgb(255, 41, 65);"><strong>0009</strong></span> 阅读文章）</p><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; word-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box; word-wrap: break-word !important;"/></p><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; word-wrap: break-word !important;">村长说： “学名是线程池， 为了充分利用资源， 我在启动时就建立了一批线程， 放到线程池里， 需要线程时直接去取就可以了。   ”</p><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; word-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box; word-wrap: break-word !important;"/></p><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; word-wrap: break-word !important;">“那要是线程池里的线程都被派出去了怎么办 ? ”</p><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; word-wrap: break-word !important;">"要么新创建线程， 要么新来的Http请求就要等待了。  实际上，线程也不是无限可用的资源， 也得复用。"</p><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; word-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box; word-wrap: break-word !important;"/></p><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; word-wrap: break-word !important;">小东心想， 我们JDBC也可以这么搞啊， 把数据库连接给缓存下来， 随用随取， <strong style="max-width: 100%; box-sizing: border-box; word-wrap: break-word !important;">一来正好可以控制码农们无限制的连接数据库； 二来可以减少数据库连接时间；  第三还可以复用Connection上的PreparedStatement, 不用老是找数据库预编译了。</strong></p></section></section></section><section class="" powered-by="xiumi.us" style="font-size: 16px; white-space: normal; max-width: 100%; box-sizing: border-box; color: rgb(62, 62, 62); line-height: 25.6px; background-color: rgb(255, 255, 255); word-wrap: break-word !important;"><section class="" style="margin-top: 10px; margin-bottom: 10px; max-width: 100%; box-sizing: border-box; word-wrap: break-word !important;"><section class="" style="padding: 2px; max-width: 100%; box-sizing: border-box; display: inline-block; background-color: rgb(0, 0, 0); word-wrap: break-word !important;"><section class="" style="margin-right: 5px; padding-right: 8px; padding-left: 8px; max-width: 100%; box-sizing: border-box; display: inline-block; color: rgb(255, 255, 255); background-color: rgb(95, 156, 239); word-wrap: break-word !important;"><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; word-wrap: break-word !important;">3</p></section><section class="" style="padding-right: 5px; padding-left: 5px; max-width: 100%; box-sizing: border-box; display: inline-block; color: rgb(255, 255, 255); word-wrap: break-word !important;"><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; word-wrap: break-word !important;">数据库连接池</p></section></section></section></section><section class="" powered-by="xiumi.us" style="font-size: 16px; white-space: normal; max-width: 100%; box-sizing: border-box; color: rgb(62, 62, 62); line-height: 25.6px; background-color: rgb(255, 255, 255); word-wrap: break-word !important;"><section class="" style="max-width: 100%; box-sizing: border-box; word-wrap: break-word !important;"><section class="" style="max-width: 100%; box-sizing: border-box; word-wrap: break-word !important;"><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; word-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"/></p><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; word-wrap: break-word !important;">建立数据库连接池不是那么一帆风顺的， 小东的第一次尝试是创建了一个ConnectionPool这个接口:</p></section></section></section><section class="" powered-by="xiumi.us" style="font-size: 16px; white-space: normal; max-width: 100%; box-sizing: border-box; color: rgb(62, 62, 62); line-height: 25.6px; background-color: rgb(255, 255, 255); word-wrap: break-word !important;"><section class="" style="margin-top: 10px; margin-bottom: 10px; max-width: 100%; box-sizing: border-box; transform: translate3d(0px, 0px, 0px); word-wrap: break-word !important;"><img class=" img_loading" data-ratio="0.27014218009478674" data-src="http://mmbiz.qpic.cn/mmbiz_png/KyXfCrME6ULGPP1sjS7STFibPuy12GtgjHItu2FHze33k9av2UdNYLXJkra5rZkcahXd1J85r8vxYXYf1ltibtjw/640?wx_fmt=png" data-type="png" data-w="422" width="auto" style="box-sizing: border-box; vertical-align: middle; word-wrap: break-word !important; visibility: visible !important; width: 370px !important; height: 99.95260663507109px !important;" _width="auto" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="/></section></section><section class="" powered-by="xiumi.us" style="font-size: 16px; white-space: normal; max-width: 100%; box-sizing: border-box; color: rgb(62, 62, 62); line-height: 25.6px; background-color: rgb(255, 255, 255); word-wrap: break-word !important;"><section class="" style="max-width: 100%; box-sizing: border-box; word-wrap: break-word !important;"><section class="" style="max-width: 100%; box-sizing: border-box; word-wrap: break-word !important;"><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; word-wrap: break-word !important;">里边有两个重要的方法， getConnection(), 用于从池中取出一个让用户使用；</p><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; word-wrap: break-word !important;">releaseConnection() 把数据库连接放回池中去。</p><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; word-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"/></p><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; word-wrap: break-word !important;">小东想， 只要我写一个ConnectionPool的实现类， 里边可以维护一个管理数据库连接的数据结构就行了， 码农们用起来也很方便， 他们肯定会喜欢的。</p><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; word-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box; word-wrap: break-word !important;"/></p><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; word-wrap: break-word !important;">可是事与愿违， 几乎没有人用这样的接口。  </p><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; word-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"/></p><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; word-wrap: break-word !important;">小东经过多方打探才明白， 码农们要么是用DriverManager来获得Connection， 要么是使用DataSource来得到Connection；关闭的时候，只需要调用Connection.close() 就可以了。</p><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; word-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box; word-wrap: break-word !important;"/></p><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; word-wrap: break-word !important;">这样的代码已经有很多了， 而小东的新方案相当于新的接口， 需要改代码才能用，  话说回来， 谁愿意没事改代码玩？  尤其是正在运行的系统。</p><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; word-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box; word-wrap: break-word !important;"/></p><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; word-wrap: break-word !important;">再做一次改进吧， 小东 去找Java 这个设计高手求教。</p><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; word-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box; word-wrap: break-word !important;"/></p><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; word-wrap: break-word !important;">Java 说：“虽然ConnectionPool概念不错， 但是具体的实现最好隐藏起来， 对码农来说，还是通过DataSource 来获取Connection,   至于这个Connection 是新建的还是从连接池中来的， 码农不应该关心， 所以应该加一个代理Proxy，把物理的Connection给封装起来，  然后把这个Proxy返回给码农。”</p><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; word-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box; word-wrap: break-word !important;"/></p><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; word-wrap: break-word !important;">“那这个Proxy是不是得和您定义的接口Connection 接口保持一致？   要不然码农还得面对新东西。”</p><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; word-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box; word-wrap: break-word !important;"/></p><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; word-wrap: break-word !important;">“是的， 这个Proxy 应该也实现JDBC的Connection 接口， 像这样： ”</p></section></section></section><section class="" powered-by="xiumi.us" style="font-size: 16px; white-space: normal; max-width: 100%; box-sizing: border-box; color: rgb(62, 62, 62); line-height: 25.6px; background-color: rgb(255, 255, 255); word-wrap: break-word !important;"><section class="" style="margin-top: 10px; margin-bottom: 10px; max-width: 100%; box-sizing: border-box; transform: translate3d(0px, 0px, 0px); word-wrap: break-word !important;"><img class=" img_loading" data-ratio="1.083916083916084" data-src="http://mmbiz.qpic.cn/mmbiz_png/KyXfCrME6ULGPP1sjS7STFibPuy12GtgjwtibOdpqNZ846LRiayOyIUgcNHmCeX6ic6pJ5hHtia66pYsqGMHQI6ASxg/640?wx_fmt=png" data-type="png" data-w="429" width="auto" style="box-sizing: border-box; vertical-align: middle; word-wrap: break-word !important; visibility: visible !important; width: 370px !important; height: 401.04895104895104px !important;" _width="auto" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="/></section></section><section class="" powered-by="xiumi.us" style="font-size: 16px; white-space: normal; max-width: 100%; box-sizing: border-box; color: rgb(62, 62, 62); line-height: 25.6px; background-color: rgb(255, 255, 255); word-wrap: break-word !important;"><section class="" style="max-width: 100%; box-sizing: border-box; word-wrap: break-word !important;"><section class="" style="max-width: 100%; box-sizing: border-box; word-wrap: break-word !important;"><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; word-wrap: break-word !important;">（点击看大图）</p><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; word-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box; word-wrap: break-word !important;"/></p><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; word-wrap: break-word !important;">小东说： ”奥， 我明白了， 当码农从DataSource中获得Connection的时候， 我返回的其实是一个ConnectionProxy ,   其中封装了一个从ConnectionPool来的Connection ,  然后把各种调用转发到这个实际的physicalConn的方法去，  关键点在close,  并不会真的关闭Connection, 而是放回到ConnectionPool “</p><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; word-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box; word-wrap: break-word !important;"/></p><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; word-wrap: break-word !important;">“哈哈， 看来你已经get了，  这就是面向接口编程的好处啊， 你给码农返回了一个ConnectionProxy, 但是码农们一无所知， 仍然以为是在使用Connection , 这是一次成功的‘欺骗’啊”</p><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; word-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box; word-wrap: break-word !important;"/></p><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; word-wrap: break-word !important;">“但是你定义的Connection 接口中的方法实在是太多了， 足足有50多个， 我这个Proxy类实际上只关注那么几个， 例如close方法， 其他的都是转发而已，这么多无聊的转发代码是在是太烦人了”</p><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; word-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box; word-wrap: break-word !important;"/></p><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; word-wrap: break-word !important;">Java说： “还有一种办法，可以用动态代理啊”</p><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; word-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"/></p><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; word-wrap: break-word !important;">小东问：“什么是动态代理?”</p><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; word-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box; word-wrap: break-word !important;"/></p><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; word-wrap: break-word !important;">"刚才我们提供的那个Proxy可以称为静态代理，   我的动态代理不用你写一个类去实现Connection, 完全可以在运行期来做， 还是先来看代码吧"</p></section></section></section><section class="" powered-by="xiumi.us" style="font-size: 16px; white-space: normal; max-width: 100%; box-sizing: border-box; color: rgb(62, 62, 62); line-height: 25.6px; background-color: rgb(255, 255, 255); word-wrap: break-word !important;"><section class="" style="margin-top: 10px; margin-bottom: 10px; max-width: 100%; box-sizing: border-box; transform: translate3d(0px, 0px, 0px); word-wrap: break-word !important;"><img class=" img_loading" data-ratio="0.8351409978308026" data-src="http://mmbiz.qpic.cn/mmbiz_png/KyXfCrME6ULGPP1sjS7STFibPuy12Gtgje3W8zbHPkpY4LpxNOktvBXS87CVweFicrtoCrNibibK4E7ia8zK22sQUicw/640?wx_fmt=png" data-type="png" data-w="461" width="auto" style="box-sizing: border-box; vertical-align: middle; word-wrap: break-word !important; visibility: visible !important; width: 370px !important; height: 309.002169197397px !important;" _width="auto" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="/></section></section><section class="" powered-by="xiumi.us" style="font-size: 16px; white-space: normal; max-width: 100%; box-sizing: border-box; color: rgb(62, 62, 62); line-height: 25.6px; background-color: rgb(255, 255, 255); word-wrap: break-word !important;"><section class="" style="max-width: 100%; box-sizing: border-box; word-wrap: break-word !important;"><section class="" style="max-width: 100%; box-sizing: border-box; word-wrap: break-word !important;"><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; word-wrap: break-word !important;">（点击看大图）<br style="max-width: 100%; box-sizing: border-box; word-wrap: break-word !important;"/></p><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; word-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box; word-wrap: break-word !important;"/></p><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; word-wrap: break-word !important;">“代码有点难懂，   你看，这里没有声明一个实际的类来实现Connection 接口 ， 而是用动态代理在运行时创建了一个类Proxy.newProxyInstance(....) ,    重点部分就是InvocationHandler,  在他的invoke方法中， 我们判断下被调用的方法是不是close, 如果是， 就把Connection 放回连接池， 如果不是，就调用实际Connection的方法。”  Java 解释了一通。</p><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; word-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box; word-wrap: break-word !important;"/></p><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; word-wrap: break-word !important;">小东惊叹到：“代码虽然难懂， 但是精简了好多，我对Java 反射不太熟， 回头我再仔细研究下。”</p><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; word-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box; word-wrap: break-word !important;"/></p><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; word-wrap: break-word !important;">（注： 不熟悉Java动态代理的也可以研究下， 这是一项重要的技术）</p><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; word-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box; word-wrap: break-word !important;"/></p><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; word-wrap: break-word !important;">经过一番折腾， 数据库连接池终于隐藏起来了， 码农们可以使用原有的方式去获取Connection, 只是不知道背后其实发生了巨变。</p><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; word-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box; word-wrap: break-word !important;"/></p><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; word-wrap: break-word !important;">当然也不可能让码农完全意识不到连接池， 毕竟他们还得去设置一些参数， 小东定义了一些：</p></section></section></section><section class="" powered-by="xiumi.us" style="font-size: 16px; white-space: normal; max-width: 100%; box-sizing: border-box; color: rgb(62, 62, 62); line-height: 25.6px; background-color: rgb(255, 255, 255); word-wrap: break-word !important;"><section class="" style="margin-top: 10px; margin-bottom: 10px; max-width: 100%; box-sizing: border-box; transform: translate3d(0px, 0px, 0px); word-wrap: break-word !important;"><img class=" img_loading" data-ratio="0.44054054054054054" data-src="http://mmbiz.qpic.cn/mmbiz_png/KyXfCrME6ULGPP1sjS7STFibPuy12GtgjssywmyZBnF1Syb4mLDlBOGtNUH2Pe8jXApqDJ0VwrYLpHBRdUjnOBw/640?wx_fmt=png" data-type="png" data-w="370" width="auto" style="box-sizing: border-box; vertical-align: middle; word-wrap: break-word !important; visibility: visible !important; width: 370px !important; height: 163px !important;" _width="auto" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="/></section></section><section class="" powered-by="xiumi.us" style="font-size: 16px; white-space: normal; max-width: 100%; box-sizing: border-box; color: rgb(62, 62, 62); line-height: 25.6px; background-color: rgb(255, 255, 255); word-wrap: break-word !important;"><section class="" style="max-width: 100%; box-sizing: border-box; word-wrap: break-word !important;"><section class="" style="max-width: 100%; box-sizing: border-box; word-wrap: break-word !important;"><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; word-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box; word-wrap: break-word !important;"/></p><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; word-wrap: break-word !important;">数据库连接池获得了巨大的成功， 几乎成了每一个Java Web项目的标配，  不一样的JDBC驱动小东也获得了极高的荣誉， 后面等着他的还会有哪些挑战呢？</p><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; word-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box; word-wrap: break-word !important;"/></p><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; word-wrap: break-word !important;">（完）</p></section></section></section><p><br/></p><p style="max-width: 100%; min-height: 1em; font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><strong style="color: rgb(62, 62, 62); max-width: 100%; line-height: 25.6px; widows: 1; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 14px; line-height: 25.6px; box-sizing: border-box !important; word-wrap: break-word !important;">小贴士：</span></strong><span style="color: rgb(62, 62, 62); max-width: 100%; line-height: 25.6px; widows: 1; font-size: 14px; box-sizing: border-box !important; word-wrap: break-word !important;">返回上一级搜索</span><span style="max-width: 100%; line-height: 25.6px; widows: 1; font-size: 14px; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="color:#3e3e3e">“</span><span style="color:#e36c09;font-family:宋体"><strong>JDBC</strong></span></span></span><span style="color: rgb(62, 62, 62); max-width: 100%; line-height: 25.6px; widows: 1; font-size: 14px; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;">” 获取更多相关文章。</span></span></p><p><span style="max-width: 100%; line-height: 25.6px; widows: 1; font-size: 14px; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"><br/></span></span></p><p style="font-size: 16px; white-space: normal; max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); line-height: 25.6px; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"/></p><blockquote style="font-size: 16px; white-space: normal; max-width: 100%; color: rgb(62, 62, 62); line-height: 25.6px; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><p style="max-width: 100%; min-height: 1em; line-height: 25.6px; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 14px; color: rgb(136, 136, 136); box-sizing: border-box !important; word-wrap: break-word !important;">来自：码农翻身（微信号：coderising）</span></p><p style="max-width: 100%; min-height: 1em; line-height: 25.6px; box-sizing: border-box !important; word-wrap: break-word !important;"><strong style="max-width: 100%; color: rgb(0, 82, 255); line-height: 25.6px; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 14px; box-sizing: border-box !important; word-wrap: break-word !important;"><img data-ratio="1" data-src="http://mmbiz.qpic.cn/mmbiz_jpg/KyXfCrME6UK2oqblHV5PIsVJ5nuPKQRnkh1xVblibaibVcQTCSZIruv8Uianv1oWpRbNiaVhAJ0iaaqpXZwxklWgC5w/640?wx_fmt=jpeg" data-type="jpeg" data-w="258" width="auto" style="box-sizing: border-box !important; word-wrap: break-word !important; visibility: visible !important; width: 258px !important; height: 258px !important;" _width="auto" class=" img_loading" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="/></span></strong></p></blockquote><p style="white-space: normal;"><br/></p><hr style="font-size: 16px; white-space: normal; line-height: 25.6px; max-width: 100%; color: rgb(62, 62, 62); background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"/><p style="font-size: 16px; white-space: normal; line-height: 25.6px; max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; white-space: pre-wrap; font-size: 14px; line-height: 25.6px; box-sizing: border-box !important; word-wrap: break-word !important;">●本文编号2331，以后想阅读这篇文章直接输入2331即可。</span></p><p style="font-size: 16px; white-space: normal; line-height: 25.6px; max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 14px; box-sizing: border-box !important; word-wrap: break-word !important;">●输入m可以获取到文章目录</span></p><section style="max-width: 100%; box-sizing: border-box; color: rgb(62, 62, 62); font-size: 16px; white-space: normal; line-height: 25.6px; background-color: rgb(255, 255, 255); word-wrap: break-word !important;"><section class="" style="max-width: 100%; box-sizing: border-box; word-wrap: break-word !important;"><section class="" style="margin-top: 10px; margin-bottom: 10px; max-width: 100%; box-sizing: border-box; text-align: center; word-wrap: break-word !important;"><section class="" style="padding-right: 1em; padding-left: 1em; max-width: 100%; box-sizing: border-box; display: inline-block; word-wrap: break-word !important;"><span class="" style="padding: 0.3em 0.5em; max-width: 100%; box-sizing: border-box; display: inline-block; border-radius: 0.5em; font-size: 14.08px; color: rgb(255, 255, 255); background-color: rgb(249, 110, 87); word-wrap: break-word !important;"><section style="max-width: 100%; box-sizing: border-box; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 16px; box-sizing: border-box !important; word-wrap: break-word !important;"><strong style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;">推荐↓↓↓</strong></span></section></span> </section><section class="" style="margin-top: -1em; padding: 20px 10px 10px; max-width: 100%; box-sizing: border-box; border-width: 1px; border-style: solid; border-color: rgb(192, 200, 209); background-color: rgb(239, 239, 239); word-wrap: break-word !important;"><section class="" style="max-width: 100%; box-sizing: border-box; word-wrap: break-word !important;"><section class="" style="max-width: 100%; box-sizing: border-box; word-wrap: break-word !important;"><section class="" style="max-width: 100%; box-sizing: border-box; text-align: left; word-wrap: break-word !important;"><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; text-align: center; word-wrap: break-word !important;"><strong style="color: rgb(32, 32, 32); font-family: inherit; font-size: 1em; text-align: center; white-space: normal; background-color: rgb(255, 255, 255); max-width: 100%; line-height: 22.4px; text-decoration: inherit; box-sizing: border-box !important; word-wrap: break-word !important;"><strong style="max-width: 100%; line-height: 22.4px; box-sizing: border-box !important; word-wrap: break-word !important;"><strong style="max-width: 100%; font-family: inherit; font-size: 1em; line-height: 22.4px; text-decoration: inherit; box-sizing: border-box !important; word-wrap: break-word !important;"><strong style="max-width: 100%; line-height: 22.4px; box-sizing: border-box !important; word-wrap: break-word !important;"><strong style="max-width: 100%; font-family: inherit; font-size: 1em; line-height: 22.4px; text-decoration: inherit; box-sizing: border-box !important; word-wrap: break-word !important;"><strong style="max-width: 100%; line-height: 22.4px; box-sizing: border-box !important; word-wrap: break-word !important;"><strong style="max-width: 100%; font-family: inherit; font-size: 1em; line-height: 22.4px; text-decoration: inherit; box-sizing: border-box !important; word-wrap: break-word !important;"><strong style="max-width: 100%; line-height: 22.4px; box-sizing: border-box !important; word-wrap: break-word !important;"><strong style="max-width: 100%; font-family: inherit; font-size: 1em; line-height: 22.4px; text-decoration: inherit; box-sizing: border-box !important; word-wrap: break-word !important;"><strong style="max-width: 100%; line-height: 22.4px; box-sizing: border-box !important; word-wrap: break-word !important;"><strong style="max-width: 100%; font-family: inherit; font-size: 1em; line-height: 22.4px; text-decoration: inherit; box-sizing: border-box !important; word-wrap: break-word !important;"><strong style="max-width: 100%; line-height: 22.4px; box-sizing: border-box !important; word-wrap: break-word !important;"><strong style="max-width: 100%; font-family: inherit; font-size: 1em; line-height: 22.4px; text-decoration: inherit; box-sizing: border-box !important; word-wrap: break-word !important;"><strong style="max-width: 100%; line-height: 22.4px; box-sizing: border-box !important; word-wrap: break-word !important;"><strong style="max-width: 100%; font-family: inherit; font-size: 1em; line-height: 22.4px; text-decoration: inherit; box-sizing: border-box !important; word-wrap: break-word !important;"><strong style="max-width: 100%; line-height: 22.4px; box-sizing: border-box !important; word-wrap: break-word !important;"><img class="__bg_gif img_loading" data-ratio="1" data-src="http://mmbiz.qpic.cn/mmbiz/NVvB3l3e9aG7cylA9f13z7vnSfVrRx3WGfNC05yWYe4icIOmBajBcA3UnrtSERg5iamwJblGbZDhticZhLgd6wnQg/0?wx_fmt=gif" data-type="gif" data-w="200" width="auto" style="white-space: pre-wrap; color: rgb(62, 62, 62); line-height: 25.6px; box-sizing: border-box !important; word-wrap: break-word !important; visibility: visible !important; width: 200px !important; height: 200px !important;" _width="auto" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" data-order="0"/></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></p><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; text-align: center; word-wrap: break-word !important;"><span style="color:#407600;max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"><strong style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;">数据库开发</strong></span></p></section></section></section></section></section></section></section><p style="font-size: 16px; white-space: normal; line-height: 25.6px; max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important; text-align: center;"><span style="text-align: center; max-width: 100%; font-size: 14px; box-sizing: border-box !important; word-wrap: break-word !important;">更多推荐</span><strong style="text-align: center; max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 14px; box-sizing: border-box !important; word-wrap: break-word !important;">《</span></strong><a href="http://mp.weixin.qq.com/s?__biz=MjM5NzA1MTcyMA==&amp;mid=402665544&amp;idx=4&amp;sn=4b9ec51c14d3d2969ba3c3aa5035a900&amp;scene=21#wechat_redirect" target="_blank" data_ue_src="http://mp.weixin.qq.com/s?__biz=MjM5NzA1MTcyMA==&amp;mid=402665544&amp;idx=4&amp;sn=4b9ec51c14d3d2969ba3c3aa5035a900&amp;scene=21#wechat_redirect" style="text-align: center; max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"><strong style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; color: rgb(255, 169, 0); box-sizing: border-box !important; word-wrap: break-word !important;">15个技术类公众微信</span></strong></a><span style="text-align: center; max-width: 100%; font-size: 14px; box-sizing: border-box !important; word-wrap: break-word !important;"><strong style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 16px; box-sizing: border-box !important; word-wrap: break-word !important;">》</span></strong></span></p><p style="font-size: 16px; white-space: normal; max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); line-height: 1.75em; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 14px; color: rgb(136, 136, 136); box-sizing: border-box !important; word-wrap: break-word !important;">涵盖：程序人生、算法与数据结构、黑客技术与网络安全、大数据技术、前端开发、Java、Python、Web开发、安卓开发、iOS开发、C/C++、.NET、Linux、数据库、运维等。</span></p>
                    